---
// CopyButton.astro
interface Props {
  code: string;
  class?: string;
}

const { code, class: className = "" } = Astro.props;
---

<button class={`copy-button ${className}`} aria-label="Copy code to clipboard">
  <svg
    class="copy-icon"
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
    <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
  </svg>
  <svg
    class="check-icon hidden"
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <polyline points="20 6 9 17 4 12"></polyline>
  </svg>
</button>

<script is:inline define:vars={{ code }}>
  const button = document.currentScript.previousElementSibling;
  const copyIcon = button.querySelector(".copy-icon");
  const checkIcon = button.querySelector(".check-icon");

  button.addEventListener("click", async () => {
    await navigator.clipboard.writeText(code);

    copyIcon.classList.add("hidden");
    checkIcon.classList.remove("hidden");

    setTimeout(() => {
      copyIcon.classList.remove("hidden");
      checkIcon.classList.add("hidden");
    }, 2000);
  });
</script>

<style>
  .copy-button {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 10;
    background: transparent;
    border: none;
    cursor: pointer;
    color: #82aaff;
    width: 20px;
    height: 20px;
  }

  .copy-icon {
    position: absolute;
    width: 20px;
    height: 20px;
    top: 0;
    left: 0;
  }

  .check-icon {
    position: absolute;
    width: 20px;
    height: 20px;
    top: -15px;
    left: 0;
  }

  .hidden {
    display: none !important;
  }
</style>
